<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Docker for C++ builds | Josh Peterson </title> <meta name="author" content="Josh Peterson"> <meta name="description" content="Josh's personal website "> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%91%8B&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://joshpeterson.github.io/blog/2020/docker-for-c-plus-plus-builds/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Josh</span> Peterson </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/philosophy/">philosophy </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/repositories/">repositories</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/publications/">publications</a> </div> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Docker for C++ builds</h1> <p class="post-meta"> Created in June 26, 2020 </p> <p class="post-tags"> <a href="/blog/2020"> <i class="fa-solid fa-calendar fa-sm"></i> 2020 </a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>A few years ago, one of my colleagues at Unity was discussing some work to get our tests running on a new local CI system. She described a recent discussion with developer services team as “Docker, Docker, Kubernetes” (hearkening back to the famous Seinfeld <a href="https://en.wikipedia.org/wiki/The_Yada_Yada" rel="external nofollow noopener" target="_blank">Yada, Yada</a> episode). As a developer with no experience in “cloud” things, this is often how I feel. These “containers” seem to be so useful, yet magical and out of reach for me. So I decided to go off on a quest and slay the “Docker, Docker, Kubernetes” dragon (well, at least Docker, I still don’t know what Kubernetes is).</p> <h2 id="using-docker-on-ci-for-c-linux-builds">Using Docker on CI for C++ Linux builds</h2> <p>One of my biggest difficulties with hobby C++ project is dealing with CI systems. <a href="https://travis-ci.com" rel="external nofollow noopener" target="_blank">Travis CI</a> has a great free service for open source projects, but often I would complete a new feature locally, only to see it fail on CI. There must be a better way to reproduce the CI build configuration locally!</p> <p>In addition, keeping up with the latest C++ compiler versions on CI is difficult. The feedback loop required to change a .yml file, push a change, then wait for a build to run on CI is simply too long. Local iteration would be much more efficient.</p> <h3 id="the-final-product">The final product</h3> <p>If you’re not interested in the details, just check out the Travis CI <a href="https://github.com/joshpeterson/cpp-template/blob/master/.travis.yml" rel="external nofollow noopener" target="_blank">configuration</a> in my cpp-template repository. I’m pretty happy with the end result. Each CI step on Linux is a single <code class="language-plaintext highlighter-rouge">docker</code> invocation that I can easily run locally.</p> <h3 id="creating-a-docker-container">Creating a Docker container</h3> <p>A container is a lightweight Linux installation where you explicitly define <em>everything</em> that is installed.</p> <ul> <li>Lightweight: it is much smaller in size than a full Linux installation; it “boots up” very fast.</li> <li>Linux: It is running a real Linux OS, and must run “on top of” a full Linux installation.</li> <li>You define what is installed: You must indicate all of the packages (e.g. in the apt-get sense) that are installed - you don’t have access to anything else.</li> </ul> <p>I’m sure this is not a good technical description of containers, but for someone with no experience in this world, I find it helpful to view them like this.</p> <p><a href="https://docker.com" rel="external nofollow noopener" target="_blank">Docker</a> is a tool for creating and running containers (there are probably other such tools out there). It accepts a Dockerfile as input. A Dockerfile is a text document written in a domain-specific language that Docker understands. This file is used to tell Docker about that third point above - what packages should be installed on your Linux container.</p> <p>These Docker inputs can get pretty complex, but you can also accomplish a lot with a simple one. My Dockerfile for builds with GCC is below:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM gcc:10.1.0
RUN apt-get update
RUN apt-get install -y cmake ninja-build time
</code></pre></div></div> <p>Let’s break this down:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM gcc:10.1.0
</code></pre></div></div> <p>The first line is the most interesting. The <code class="language-plaintext highlighter-rouge">FROM</code> statement means “Create this container by starting from another container first.” The starting container in this case is named “gcc” (more on that later). The part after the colon is the “tag”, which could be anything, but is most often a version number.</p> <p>But where does this “gcc” container come from? Docker has a service called <a href="https://hub.docker.com/" rel="external nofollow noopener" target="_blank">Dockerhub</a> where anyone can publish Docker containers. The name “gcc” means “Look for a container named gcc on Dockerhub. If you find one, download it, and use it as the starting point for my container.”</p> <p>The GCC developers publish a container on Dockerhub for each GCC release. This container is based in turn on a Debian Linux container. So now my container can have everything set up and ready to go to use GCC version 10.1.0 with just one line in my Dockerfile, neat!</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RUN apt-get update
RUN apt-get install -y cmake ninja-build time
</code></pre></div></div> <p>These last to lines use the <code class="language-plaintext highlighter-rouge">RUN</code> statement, which tells Docker to execute the text following is as a shell command. The two specific commands I’m using tell the Debian package manager (<code class="language-plaintext highlighter-rouge">apt</code>) to first update to repositories to look for the latest packages, then install three packages that I need to build the C++ code in my projects: CMake, Ninja, and the <code class="language-plaintext highlighter-rouge">time</code> command (see, you really need to install, <em>everything</em> you need).</p> <h3 id="solving-my-problems">Solving my problems</h3> <p>Wow, so this is really cool - I’m doing cloud stuff! ☁️ But seriously, this solves my two problems with CI:</p> <ul> <li>Updating the version of a C++ compiler is now as simple as changing one version number in my Dockerfile.</li> <li>I can test my CI set up locally by running one Docker command, so iteration on CI changes is now much faster.</li> </ul> <p>🎉</p> <h3 id="my-docker-images">My docker images</h3> <p>I’ve created Docker images for <a href="https://hub.docker.com/r/petersonjm1/gcc" rel="external nofollow noopener" target="_blank">GCC</a>, <a href="https://hub.docker.com/r/petersonjm1/clang" rel="external nofollow noopener" target="_blank">Clang</a>, and <a href="https://hub.docker.com/r/petersonjm1/emscripten" rel="external nofollow noopener" target="_blank">Emscripten</a> on Linux (I’m working on a Windows image, but that is not complete yet). You can check them out on Dockerhub and maybe use them as a base for your image. Happy cloud fun! 🌩️</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/more-fun-with-loop-unrolling-cpp/">More fun with loop unrolling - C++</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/learning-loop-unrolling/">Learning loop unrolling</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/constraints-are-liberating/">Constraints are liberating</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/span-making-c-arrays-fun-since-2020/">Span - making C arrays fun since 2020</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/game-theory-fun-in-the-nfl/">Game theory fun in the NFL</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Josh Peterson. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: March 16, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>