<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> The cost of set-jump long-jump exceptions | Josh Peterson </title> <meta name="author" content="Josh Peterson"> <meta name="description" content="Josh's personal website "> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%91%8B&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://joshpeterson.github.io/blog/2014/the-cost-of-setjump-longjump-exceptions/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Josh</span> Peterson </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/philosophy/">philosophy </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/repositories/">repositories</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/publications/">publications</a> </div> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">The cost of set-jump long-jump exceptions</h1> <p class="post-meta"> Created in May 28, 2014 </p> <p class="post-tags"> <a href="/blog/2014"> <i class="fa-solid fa-calendar fa-sm"></i> 2014 </a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Last year Google <a href="https://groups.google.com/forum/#!topic/native-client-discuss/0spfg6O04FM" rel="external nofollow noopener" target="_blank">announced</a> support for C++ exceptions in the PNaCL tool chain of their <a href="https://developer.chrome.com/native-client/overview" rel="external nofollow noopener" target="_blank">Native Client</a> technology. Since my experimental project <a href="https://github.com/joshpeterson/osoasso" rel="external nofollow noopener" target="_blank">Osoasso</a> uses exceptions for some error handling, this was excellent news. I decided to start working to build my project using PNaCL. However, I was intrigued by this statement in the announcement:</p> <blockquote> <p>As before C++ exception handling is off by default, to ensure better performance and smaller code size. It is possible to use set-jump long-jump exception handling on stable pexes with the –pnacl-exceptions=sjlj compiler flag. Full zero-cost exceptions are currently only supported for unstable pexes…</p> </blockquote> <p>I was unfamiliar with the concept of set-jump long-jump exception handling, and I wondered why it had some cost associated with it. Here I’ll attempt to explain that cost.</p> <h2 id="what-is-set-jump-long-jump-exception-handling">What is set-jump long-jump exception handling?</h2> <p>Set-jump long-jump exception handling is a simple method of exception handling implementation that uses the C methods <code class="language-plaintext highlighter-rouge">setjmp</code> and <code class="language-plaintext highlighter-rouge">longjmp</code> (or something like them). The <code class="language-plaintext highlighter-rouge">setjmp</code> method is used to store all of the processor state at a given location, and the <code class="language-plaintext highlighter-rouge">longjmp</code> method is used used to return to that processor state and location if necessary. In LLVM (which is used for the PNaCL implementation), the <a href="http://llvm.org/docs/ExceptionHandling.html#llvm-eh-sjlj-setjmp" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">llvm.eh.sjlj.setjmp</code></a> and <a href="http://llvm.org/docs/ExceptionHandling.html#llvm-eh-sjlj-longjmp" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">llvm.eh.sjlj.longjmp</code></a> intrinsics are used.</p> <p>This type of exception handling is not considered zero-cost, since some additional code must be executed for each <code class="language-plaintext highlighter-rouge">try</code> block or <code class="language-plaintext highlighter-rouge">throw</code> statement, even if the no exception occurs. As the LLVM exception handling <a href="http://llvm.org/docs/ExceptionHandling.html" rel="external nofollow noopener" target="_blank">documentation</a> states:</p> <blockquote> <p>…SJLJ exception handling builds and removes the unwind frame context at runtime. This results in faster exception handling at the expense of slower execution when no exceptions are thrown. As exceptions are, by their nature, intended for uncommon code paths, DWARF exception handling is generally preferred to SJLJ.</p> </blockquote> <h2 id="how-can-exceptions-be-enabled-with-pnacl">How can exceptions be enabled with PNaCL?</h2> <p>Exception handling can be enabled with PNaCL at compile and link time use the <code class="language-plaintext highlighter-rouge">--pnacl-exceptions=sjlj</code> flag. This flag must be passed to both the compiler and the linker. So in my Makefile, I have the following lines:</p> <figure class="highlight"><pre><code class="language-makefile" data-lang="makefile"><span class="nv">CFLAGS</span> <span class="o">=</span> <span class="nt">-Wall</span> <span class="nt">-Wno-long-long</span> <span class="nt">-pthread</span> <span class="nt">-Werror</span> <span class="nt">-std</span><span class="o">=</span>gnu++11 <span class="nt">-O2</span> <span class="nt">--pnacl-exceptions</span><span class="o">=</span>sjlj
<span class="nv">LDFLAGS</span> <span class="o">=</span> <span class="nt">--pnacl-exceptions</span><span class="o">=</span>sjlj

<span class="err">...</span>

<span class="nf">$(</span><span class="nb">eval</span> <span class="p">$(</span>call LINK_RULE,<span class="p">$(</span>TARGET<span class="p">)</span>_unstripped,<span class="p">$(</span>SOURCES<span class="p">)</span>,<span class="p">$(</span>LIBS<span class="p">)</span>,<span class="p">$(</span>DEPS<span class="p">)</span>,<span class="p">$(</span>LDFLAGS<span class="p">)))</span></code></pre></figure> <p>I spent a good bit of time wondering why the code in the first two lines did not work initially. Then I later realized that the <code class="language-plaintext highlighter-rouge">LDFLAGS</code> variable was not being passed to the <code class="language-plaintext highlighter-rouge">LINK_RULE</code> by default. I had to manually add it!</p> <h2 id="what-is-the-cost-of-sjlj-exceptions">What is the cost of SJLJ exceptions?</h2> <p>First, I measured the cost of SJLJ exceptions in two ways:</p> <ol> <li>Compile time</li> <li>Executable size</li> </ol> <p>The following table shows the data for both of these cases with and without exceptions.</p> <center> <table class="gridtable"> <tr> <th></th> <th>Without Exceptions</th> <th>With SJLJ Exceptions</th> </tr> <tr> <td>Compile time</td> <td>2m 54 s</td> <td>3m 1s</td> </tr> <tr> <td>Executable size</td> <td>394,000 bytes</td> <td>583,748 bytes</td> </tr> </table> </center> <p>The most important cost of these exceptions is executable size. Osoasso is distributed via the web. Every extra byte matters, since it is an extra byte the user will have to download and extra time the user will wait to begin using the application.</p> <h2 id="what-is-the-run-time-cost-of-sjlj-exceptions">What is the run-time cost of SJLJ exceptions?</h2> <p>To measure the run-time cost of SJLJ exceptions, I wanted to execute some code that includes <code class="language-plaintext highlighter-rouge">throw</code> statements but does not actually throw any exceptions. Also, the time to execute the code to perform the actual math should not be too significant, so it will not trump the exception handling code. I choose to use the <code class="language-plaintext highlighter-rouge">add</code> command to add two 100x100 matrices. This code throws exceptions if the matrices are not of the correct size.</p> <figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="k">if</span> <span class="p">(</span><span class="n">left</span><span class="o">-&gt;</span><span class="n">rows</span><span class="p">()</span> <span class="o">!=</span> <span class="n">right</span><span class="o">-&gt;</span><span class="n">rows</span><span class="p">())</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">stringstream</span> <span class="n">message</span><span class="p">;</span>
  <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="s">"Matrices do not have the same number of rows"</span>
          <span class="o">&lt;&lt;</span> <span class="s">" left: "</span> <span class="o">&lt;&lt;</span> <span class="n">left</span><span class="o">-&gt;</span><span class="n">rows</span><span class="p">()</span> 
          <span class="o">&lt;&lt;</span> <span class="s">" right: "</span> <span class="o">&lt;&lt;</span> <span class="n">right</span><span class="o">-&gt;</span><span class="n">rows</span><span class="p">();</span>
  <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">invalid_argument</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">str</span><span class="p">());</span>
<span class="p">}</span>
<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">left</span><span class="o">-&gt;</span><span class="n">columns</span><span class="p">()</span> <span class="o">!=</span> <span class="n">right</span><span class="o">-&gt;</span><span class="n">columns</span><span class="p">())</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">stringstream</span> <span class="n">message</span><span class="p">;</span>
  <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="s">"Matrices do not have the same number of columns"</span>
          <span class="o">&lt;&lt;</span> <span class="s">" left: "</span> <span class="o">&lt;&lt;</span> <span class="n">left</span><span class="o">-&gt;</span><span class="n">columns</span><span class="p">()</span> 
          <span class="o">&lt;&lt;</span> <span class="s">" right: "</span> <span class="o">&lt;&lt;</span> <span class="n">right</span><span class="o">-&gt;</span><span class="n">columns</span><span class="p">();</span>
  <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">invalid_argument</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">str</span><span class="p">());</span>
<span class="p">}</span></code></pre></figure> <center> <table class="gridtable"> <tr> <th></th> <th>Without Exceptions</th> <th>With SJLJ Exceptions</th> </tr> <tr> <td>Time to add matrices</td> <td>0.01317 s</td> <td>0.01551 s</td> </tr> </table> </center> <p>So although there is a run-time cost for SJLJ exception handling, it not too significant. For most operations in Osoasso, exception handling is not a part of the code which performs the math, so SJLJ exception handling does not cause run-time overhead that will have a significant impact.</p> <h2 id="how-are-sjlj-exceptions-implemented">How are SJLJ exceptions implemented?</h2> <p>To better understand why this exception handling scheme has any run-time cost for the non-exceptional path, I decided to investigate the implementation details.</p> <p>The normal build for PNaCL generates a LLVM bitcode file and a .pexe file. Following the instructions <a href="http://www.chromium.org/nativeclient/pnacl/experimenting-with-generated-bitcode" rel="external nofollow noopener" target="_blank">here</a> I was able to generate a human-readable text file of the LLVM bitcode using this command:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>%NACL_SDK_ROOT%\toolchain\win_pnacl\bin\pnacl-dis osoasso_unstripped.bc
</code></pre></div></div> <p>As an example, I took a look at the generated code for the <a href="https://github.com/joshpeterson/osoasso/blob/master/src/jacobi_eigen_solver.cc" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">jacobi_eigen_solver</code></a> command, which requires that its input matrix be symmetric. The section of the code which makes this check looks like this:</p> <figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="n">transpose</span> <span class="n">transpose_command</span><span class="p">;</span>
<span class="k">auto</span> <span class="n">input_transpose</span> <span class="o">=</span> <span class="n">transpose_command</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">input</span> <span class="o">!=</span> <span class="o">*</span><span class="n">input_transpose</span><span class="p">)</span>
    <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">invalid_argument</span><span class="p">(</span><span class="s">"The input matrix is not a symmetric matrix. This command requires a symmetric matrix."</span><span class="p">);</span></code></pre></figure> <p>Unfortunately, the generated LLVM bitcode for even this simple example is rather large, so I’ll attempt to summarize it.</p> <p>Without exceptions enabled, these lines represent the <code class="language-plaintext highlighter-rouge">if</code> check in C++:</p> <figure class="highlight"><pre><code class="language-llvm" data-lang="llvm"><span class="nv">%22</span> <span class="p">=</span> <span class="k">icmp</span> <span class="k">ult</span> <span class="kt">i64</span> <span class="nv">%sub7.i.off.i.i</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="nv">!dbg</span> <span class="nv">!270096</span>
<span class="nv">%inc.i.i</span> <span class="p">=</span> <span class="k">add</span> <span class="kt">i32</span> <span class="nv">%j.037.i.i</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="nv">!dbg</span> <span class="nv">!270070</span>
<span class="k">br</span> <span class="kt">i1</span> <span class="nv">%22</span><span class="p">,</span> <span class="kt">label</span> <span class="nv">%for.cond7.i.i</span><span class="p">,</span> <span class="kt">label</span> <span class="nv">%if.then</span><span class="p">,</span> <span class="nv">!dbg</span> <span class="nv">!270068</span></code></pre></figure> <p>Here the <a href="http://llvm.org/docs/LangRef.html#icmp-instruction" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">icmp</code></a> instruction is performing the comparison and the <a href="http://llvm.org/docs/LangRef.html#br-instruction" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">br</code></a> instruction actually branches to the exceptional path if the value in <code class="language-plaintext highlighter-rouge">%22</code> is false. The exceptional path is in the <code class="language-plaintext highlighter-rouge">if.then</code> label, where eventually the code will call <code class="language-plaintext highlighter-rouge">abort</code> because exception handling is disabled. Note however that the non-exceptional path requires no additional instructions. All of the exception handling code in this case is on the exceptional path.</p> <p>If, instead, SJLJ exceptions are enabled, then the following code is generated for the <code class="language-plaintext highlighter-rouge">if</code> statement in C++:</p> <figure class="highlight"><pre><code class="language-llvm" data-lang="llvm"><span class="nv">%exception</span> <span class="p">=</span> <span class="k">call</span> <span class="kt">i32</span> <span class="vg">@__cxa_allocate_exception</span><span class="p">(</span><span class="kt">i32</span> <span class="m">8</span><span class="p">),</span> <span class="nv">!dbg</span> <span class="nv">!272907</span>
<span class="nv">%gep13.asptr61</span> <span class="p">=</span> <span class="k">inttoptr</span> <span class="kt">i32</span> <span class="nv">%gep13</span> <span class="k">to</span> <span class="kt">i32</span><span class="p">*</span>
<span class="nv">%old_eh_stack1</span> <span class="p">=</span> <span class="k">load</span> <span class="kt">i32</span><span class="p">*</span> <span class="nv">%gep13.asptr61</span><span class="p">,</span> <span class="k">align</span> <span class="m">1</span>
<span class="nv">%gep10.asptr62</span> <span class="p">=</span> <span class="k">inttoptr</span> <span class="kt">i32</span> <span class="nv">%gep10</span> <span class="k">to</span> <span class="kt">i32</span><span class="p">*</span>
<span class="k">store</span> <span class="kt">i32</span> <span class="nv">%old_eh_stack1</span><span class="p">,</span> <span class="kt">i32</span><span class="p">*</span> <span class="nv">%gep10.asptr62</span><span class="p">,</span> <span class="k">align</span> <span class="m">1</span>
<span class="nv">%gep.asptr63</span> <span class="p">=</span> <span class="k">inttoptr</span> <span class="kt">i32</span> <span class="nv">%gep</span> <span class="k">to</span> <span class="kt">i32</span><span class="p">*</span>
<span class="k">store</span> <span class="kt">i32</span> <span class="m">1</span><span class="p">,</span> <span class="kt">i32</span><span class="p">*</span> <span class="nv">%gep.asptr63</span><span class="p">,</span> <span class="k">align</span> <span class="m">1</span>
<span class="nv">%gep13.asptr64</span> <span class="p">=</span> <span class="k">inttoptr</span> <span class="kt">i32</span> <span class="nv">%gep13</span> <span class="k">to</span> <span class="kt">i32</span><span class="p">*</span>
<span class="k">store</span> <span class="kt">i32</span> <span class="nv">%invoke_frame.asint</span><span class="p">,</span> <span class="kt">i32</span><span class="p">*</span> <span class="nv">%gep13.asptr64</span><span class="p">,</span> <span class="k">align</span> <span class="m">1</span>
<span class="c1">;</span>
<span class="c1">; I have shortened the method name below</span>
<span class="c1">;</span>
<span class="nv">%invoke_is_exc2</span> <span class="p">=</span> <span class="k">call</span> <span class="kt">i32</span> <span class="vg">@_setjmp_caller519</span><span class="p">(</span><span class="kt">i32</span> <span class="nv">%exception</span><span class="p">,</span> <span class="kt">i32</span> <span class="nv">%invoke_frame.asint</span><span class="p">)</span>
<span class="nv">%gep13.asptr65</span> <span class="p">=</span> <span class="k">inttoptr</span> <span class="kt">i32</span> <span class="nv">%gep13</span> <span class="k">to</span> <span class="kt">i32</span><span class="p">*</span>
<span class="k">store</span> <span class="kt">i32</span> <span class="nv">%old_eh_stack1</span><span class="p">,</span> <span class="kt">i32</span><span class="p">*</span> <span class="nv">%gep13.asptr65</span><span class="p">,</span> <span class="k">align</span> <span class="m">1</span>
<span class="nv">%invoke_sj_is_zero3</span> <span class="p">=</span> <span class="k">icmp</span> <span class="k">eq</span> <span class="kt">i32</span> <span class="nv">%invoke_is_exc2</span><span class="p">,</span> <span class="m">0</span>
<span class="k">br</span> <span class="kt">i1</span> <span class="nv">%invoke_sj_is_zero3</span><span class="p">,</span> <span class="kt">label</span> <span class="nv">%invoke.cont7</span><span class="p">,</span> <span class="kt">label</span> <span class="nv">%lpad6</span></code></pre></figure> <p>This code starts with a call to allocate the exception, then ends up calling the <code class="language-plaintext highlighter-rouge">setjmp_caller</code> method, which actually makes the decision about whether or not the exception should be thrown. Here is the content of that method:</p> <figure class="highlight"><pre><code class="language-llvm" data-lang="llvm"><span class="nv">%jmp_buf.asptr</span> <span class="p">=</span> <span class="k">inttoptr</span> <span class="kt">i32</span> <span class="nv">%jmp_buf</span> <span class="k">to</span> <span class="kt">i8</span><span class="p">*</span>
<span class="nv">%invoke_sj</span> <span class="p">=</span> <span class="k">call</span> <span class="kt">i32</span> <span class="vg">@llvm.nacl.setjmp</span><span class="p">(</span><span class="kt">i8</span><span class="p">*</span> <span class="nv">%jmp_buf.asptr</span><span class="p">)</span>
<span class="nv">%invoke_sj_is_zero</span> <span class="p">=</span> <span class="k">icmp</span> <span class="k">eq</span> <span class="kt">i32</span> <span class="nv">%invoke_sj</span><span class="p">,</span> <span class="m">0</span>
<span class="k">br</span> <span class="kt">i1</span> <span class="nv">%invoke_sj_is_zero</span><span class="p">,</span> <span class="kt">label</span> <span class="nv">%normal</span><span class="p">,</span> <span class="kt">label</span> <span class="nv">%exception</span>

<span class="nl">normal:</span>                                           <span class="c1">; preds = %0</span>
<span class="nv">%expanded1</span> <span class="p">=</span> <span class="k">ptrtoint</span> <span class="p">[</span><span class="m">86</span> <span class="p">x</span> <span class="kt">i8</span><span class="p">]*</span> <span class="vg">@.str414</span> <span class="k">to</span> <span class="kt">i32</span>
<span class="k">call</span> <span class="kt">void</span> <span class="vg">@_ZNSt11logic_errorC2EPKc</span><span class="p">(</span><span class="kt">i32</span> <span class="nv">%arg</span><span class="p">,</span> <span class="kt">i32</span> <span class="nv">%expanded1</span><span class="p">)</span>
<span class="k">ret</span> <span class="kt">i32</span> <span class="m">0</span>

<span class="nl">exception:</span>                                        <span class="c1">; preds = %0</span>
<span class="k">ret</span> <span class="kt">i32</span> <span class="m">1</span></code></pre></figure> <p>The only conditional here is used to determine the return value of the <code class="language-plaintext highlighter-rouge">setmp_caller</code> method, so all of this code will be executed even when on the non-exceptional path. Note that <code class="language-plaintext highlighter-rouge">str414</code> is the actual exception string that will be the passed to the exception constructor.</p> <p>So it is clear that SJLJ exception handling requires at least two additional function calls, plus some additional code on the non-exceptional path. Hence, it is not considered no-cost exception handling.</p> <h2 id="why-was-sjlj-exception-handling-chosen">Why was SJLJ exception handling chosen?</h2> <p>According to the <a href="https://docs.google.com/document/d/1Bub1bV_IIDZDhdld-zTULE2Sv0KNbOXk33KOW8o0aR4/edit" rel="external nofollow noopener" target="_blank">design document</a> for this feature, SJLJ exception handling was chosen as a stop-gap solution to implement exception handling for PNaCL since it required no changes to the ABI. Zero-cost exception handling for PNaCL is coming in a future release, but it is not ready yet.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/more-fun-with-loop-unrolling-cpp/">More fun with loop unrolling - C++</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/learning-loop-unrolling/">Learning loop unrolling</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/constraints-are-liberating/">Constraints are liberating</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/span-making-c-arrays-fun-since-2020/">Span - making C arrays fun since 2020</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/game-theory-fun-in-the-nfl/">Game theory fun in the NFL</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Josh Peterson. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: March 16, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>